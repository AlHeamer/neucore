<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Brave Collective Core Services</title>
	<link rel="stylesheet" href="/node_modules/bootswatch/dist/darkly/bootstrap.min.css">
	<link href="/node_modules/open-iconic/font/css/open-iconic-bootstrap.min.css" rel="stylesheet">
	<script src="/node_modules/jquery/dist/jquery.min.js"></script>
	<script src="/node_modules/popper.js/dist/umd/popper.min.js"></script>
	<script src="/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
	<script src="/node_modules/vue/dist/vue.min.js"></script>
	<style>
		.jumbotron {
			position: relative;
			min-height: 430px;
		}
		#preview {
			position: absolute;
			right: 20px;
			font-size: 3em;
			font-family: impact, sans-serif;
			letter-spacing: 30px;
			color: #dd3333;
			text-shadow: 1px 1px black;
			padding-left: 30px;
			transform: rotate(10deg);
			background-color: rgba(200, 200, 200, .5);
			display: none;
		}
		#msg-update-done,
		#msg-login-error {
			position: fixed;
			top: 170px;
			left: 25%;
			right: 25%;
			z-index: 5000;
			display: none;
		}
		#loader {
			position: fixed;
			top: 25px;
			left: 50%;
			width: 120px;
			height: 120px;
			margin-left: -60px;
			z-index: 5000;
			border: 16px solid #555;
			border-top: 16px solid #eee;
			border-radius: 50%;
			animation: spin 2s linear infinite;
			display: none;
		}
		@keyframes spin {
			0% { transform: rotate(0deg); }
			100% { transform: rotate(360deg); }
		}
	</style>
</head>
<body>
	<div id="app">

		<div class="alert alert-success" id="msg-update-done">Update done.</div>
		<div class="alert alert-danger alert-dismissible fade show" id="msg-login-error">
			&nbsp; {{ loginErrorMessage }}
			<button type="button" class="close" data-dismiss="alert" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			</button>
		</div>
		<div id="loader"></div>
		<div class="modal fade" id="tokenModal">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">Invalid ESI token</h5>
						<button type="button" class="close" data-dismiss="modal">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						The ESI token for this character is no longer valid.<br>
						Please use the EVE login button and login with this character
						again to create a new token.
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>

		<nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
			<a class="navbar-brand" href="https://www.bravecollective.com/" target="_blank"
					title="Brave Collective: What's your fun per hour?">
				<img src="images/brave_32.png" class="align-top mr-2" alt="Brave logo">
				Brave Collective
			</a>
			<ul class="navbar-nav mr-auto"></ul>
			<img v-if="authChar" :src="'https://image.eveonline.com/Character/' + authChar.id + '_32.jpg'"
				class="d-inline-block align-top mr-2" alt="Character Portrait">
			<span class="navbar-brand" v-if="authChar">{{ authChar.name }}</span>
			<input v-on:click="logout" v-if="authChar" class="btn btn-outline-success" type="submit" value="Sign Out">
		</nav>

		<div class="container-fluid">
			<div class="row">
				<div class="col-lg-12">
					<div class="jumbotron mt-3">
						<span id="preview">PREVIEW</span>
						<a href="https://www.bravecollective.com/" target="_blank">
							<img src="/images/brave_300.png" class="float-right" alt="Brave logo"
								title="Brave Collective: What's your fun per hour?">
						</a>
						<h1 class="display-3">BRAVE Core</h1>
						<p class="lead">
							This site provides access to alliance services such as Mumble, Wiki and Forum.
						</p>
						<hr class="my-4">

						<div v-if="! authChar">
							<p class="lead">
								Click the button below to login through <i>EVE Online SSO</i>.
							</p>
							<a :href="loginUrl">
								<img src="/images/EVE_SSO_Login_Buttons_Large_Black.png" alt="LOG IN with EVE Online">
							</a>
							<p>
								<br>
								<small>
									Learn more about the security of <i>EVE Online SSO</i> in this
				<a href="https://www.eveonline.com/article/eve-online-sso-and-what-you-need-to-know/" target="_blank">
									dev-blog</a> article.
								</small>
							</p>
						</div>

						<div v-if="authChar">
							<p>Please add all your characters by logging in with EVE SSO.</p>
							<p class="lead">
								<a :href="loginAltUrl"><img src="/images/eve_sso.png" alt="LOG IN with EVE Online"></a>
							</p>
						</div>

					</div>
				</div>
			</div> <!-- row -->

			<div v-if="authChar">
				<div class="row">
					<div class="col-lg-8">
						<h2>Characters</h2>
					</div>
					<div class="col-lg-4"></div>
				</div>
				<div class="row">
					<div class="col-lg-8">
						<div class="card-columns">
							<div v-for="char in player.characters" class="card border-secondary bg-light">
								<div class="card-header">
									<img :src="'https://image.eveonline.com/Character/'+char.id+'_32.jpg'"
										alt="Character Portrait">
									{{ char.name }}
								</div>
								<div class="card-body">
									<p class="card-text">
										<span class="text-muted">Corporation:</span>
										<span v-if="char.corporation">
											{{ char.corporation.name }}
										</span>
										<br>
										<span class="text-muted">Alliance:</span>
										<span v-if="char.corporation && char.corporation.alliance">
											{{ char.corporation.alliance.name }}
										</span>
									</p>
								</div>
								<div class="card-footer">
									<span v-if="char.main" class="oi oi-star text-warning mr-2" title="Main"
										aria-hidden="true"></span>

									<button v-if="! char.validToken" type="button" class="btn btn-danger btn-sm"
										data-toggle="modal" data-target="#tokenModal">
										Invalid ESI token
									</button>

									<button v-if="! char.main && char.validToken"
										type="button" class="btn btn-primary btn-sm" v-on:click="makeMain(char.id)">
										Make Main
									</button>
									<button v-if="char.validToken"
										type="button" class="btn btn-primary btn-sm"
										v-on:click="update(char.id)">
										<span class="oi oi-loop-circular pull-right"></span>
										Update
									</button>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-4">
						<div class="card border-secondary mb-3">
							<h3 class="card-header">Groups</h3>
							<ul class="list-group list-group-flush">
								<li v-for="group in player.groups" class="list-group-item">
									{{ group.name }}
								</li>
							</ul>
						</div>
						<div v-if="player.managerGroups && player.managerGroups.length > 0"
								class="card border-secondary mb-3" >
							<h3 class="card-header">Group Manager</h3>
							<ul class="list-group list-group-flush">
								<li v-for="mg in player.managerGroups" class="list-group-item">
									{{ mg.name }}
								</li>
							</ul>
						</div>
						<div v-if="player.managerApps && player.managerApps.length > 0"
								class="card border-secondary mb-3" >
							<h3 class="card-header">App Manager</h3>
							<ul class="list-group list-group-flush">
								<li v-for="ag in player.managerApps" class="list-group-item">
									{{ ag.name }}
								</li>
							</ul>
						</div>
					</div>
				</div> <!-- row -->
			</div> <!-- if authenticated -->
		</div> <!-- container -->
	</div>
	<script src="/index.js"></script>
</body>
</html>
